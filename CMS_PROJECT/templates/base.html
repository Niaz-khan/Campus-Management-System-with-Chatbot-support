<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart UMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'home' %}">Smart UMS</a>

            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    {% if user.is_authenticated %}
                        {% if user.role == 'student' %}
                            <li class="nav-item"><a class="nav-link" href="{% url 'student_dashboard' %}">Dashboard</a></li>
                        {% elif user.role == 'faculty' %}
                            <li class="nav-item"><a class="nav-link" href="{% url 'faculty_dashboard' %}">Dashboard</a></li>
                        {% elif user.role == 'admin' %}
                            <li class="nav-item"><a class="nav-link" href="{% url 'admin_dashboard' %}">Dashboard</a></li>
                        {% endif %}
                        <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
                    {% else %}
                        <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        {% block content %}
        {% endblock %}
    </div>

    <!-- Floating Chatbot Button -->
<button id="chatbot-toggle" style="
position: fixed;
bottom: 30px;
left: 30px;
background-color: #0d6efd;
color: white;
border: none;
border-radius: 50%;
width: 60px;
height: 60px;
font-size: 24px;
cursor: pointer;
z-index: 1000;
">
ðŸ’¬
</button>

<!-- Chatbot Box (Initially Hidden) -->
<div id="chatbot-box" style="
display: none;
position: fixed;
bottom: 100px;
left: 30px;
width: 300px;
height: 400px;
background: white;
border: 1px solid #ccc;
border-radius: 8px;
box-shadow: 0 2px 10px rgba(0,0,0,0.3);
z-index: 1001;
overflow: hidden;
padding: 10px;
">
<h5>Ask Chatbot</h5>
<form id="chatbot-form" method="POST" action="{% url 'chatbot_chat' %}">
    {% csrf_token %}
    <input type="text" name="question" id="chatbot-question" class="form-control mb-2" placeholder="Type your question..." required>
    <button type="submit" class="btn btn-primary btn-sm">Ask</button>
</form>
<div id="chatbot-answer" class="mt-2" style="max-height: 250px; overflow-y: auto;"></div>
</div>

<script>
// Toggle Chatbot box
document.getElementById('chatbot-toggle').addEventListener('click', function() {
var box = document.getElementById('chatbot-box');
if (box.style.display === 'none') {
    box.style.display = 'block';
} else {
    box.style.display = 'none';
}
});

// Handle form submission using JavaScript Fetch API
document.getElementById('chatbot-form').addEventListener('submit', function(event) {
event.preventDefault();

var question = document.getElementById('chatbot-question').value;
var answerBox = document.getElementById('chatbot-answer');

fetch("{% url 'chatbot_chat' %}", {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRFToken': '{{ csrf_token }}'
    },
    body: 'question=' + encodeURIComponent(question)
})
.then(response => response.text())
.then(html => {
    answerBox.innerHTML = html;
    document.getElementById('chatbot-question').value = '';
})
.catch(error => {
    console.error('Error:', error);
});
});
</script>




</body>
</html>
